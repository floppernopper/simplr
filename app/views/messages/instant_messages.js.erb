<% if @instant_messages.present? %>
  var anchor = $("#instant_messages_anchor");
  var seen_anchor = $("#last_message_views_anchor");
  var seen_views = $("#last_message_views_<%= @folder.id %>");
  
  if ( typeof last_message_id === 'undefined'
    || last_message_id < <%= @instant_messages.first.id %>
    || last_message_id !== <%= @instant_messages.last.id %> )
  {
    var last_message_id = <%= @instant_messages.last.id %>;
    var container = $("#messages_container");
    
    anchor.after("<%=j render 'messages/instant_messages' %>");
    container.remove(); anchor.remove();
    $("#instant_messages_anchor").scrollView();
    
    // play audio for IM received
    $("#audio_play")[0].currentTime = 0;
    $("#audio_play")[0].play();
  }
  
  // updates last message views list
  seen_views.remove();
  seen_anchor.after("<%=j render 'messages/seen', message: @instant_messages.last %>");
<% end %>
